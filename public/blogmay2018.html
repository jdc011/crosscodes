<!DOCTYPE html>
<html>
   <title>Crosscodes</title>
   <meta charset="UTF-8"> 
   <head>
      <!-- Bootstrap for mobile devices -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="width=device-width, initial-scale=1,
      maximum-scale=1, user-scalable=no">

      <!-- CSS -->
      <link rel="stylesheet" type="text/css" href="mystyle.css">
   </head>
   
   <!-- Styles and scripts -->
   <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> 
   <link rel="icon" href="icon.png">
   <link rel="stylesheet"
   href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
   integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
   crossorigin="anonymous">
   <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
   crossorigin="anonymous"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
   crossorigin="anonymous"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
   crossorigin="anonymous"></script>
   <script src="nav.js"></script>

   <body background="background.jpg">
      <!-- Nav bar -->        
      <nav class="navbar navbar-expand-lg navbar-light bg-light" style="position:fixed">
         <ul class="navbar-nav mr-auto">
            <li><a href="index.html" style="font-size: 40px; font-family:Verdana, Geneva, sans-serif;"><b>Cross Codes</b></a></li>
         </ul>

         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
         </button>
         
         <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav ml-auto" style="font-size: 25px">
               <li><a href="index.html">About</a></li>
               <li><a href="experience.html">Experience</a></li>
               <li><a href="projects.html">Projects</a></li>
               <li><a href="contact.html">Contact</a></li>
               <li><a href="blog.html" style="font-weight:bold;font-size: 35px;">Blog</a></li>
            </ul>
         </div>
      </nav>
      
      <br/>
      <br/>
      <br/>
      
      <!-- Content -->
      <div style="margin-left:0%"> 
         <div class="w3-container w3-animate-opacity">

         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>

         <div class="container">
            <div class="row">
               <div class="col">
                  <div class="title">
                     <center><font size="7px" style="color:grey;font-family:Georgia"><b>Archive: May 2018<br /></b></font>
                  </div>
               </div>
            </div>
         </div>

         <div class="container">
         <div class="row">
         <div class="col">
            <br/>
            
            <div class="box">
               <div class="title">
                  <center>
                     <font size="6px" style="color:grey;font-family:Georgia"><b>Cross Codes Blog<br /></b></font>
                  </center>
               </div>

               <br/>
               
               <img src="jeremy2.png" height="100%" width="100%"\>
               
               <br/>
               <br/>

               <hr color="grey"/>
           
               <center><input placeholder="Search..." list="posts" name="post" id="search"><br/><br/> 
               <input type="button" value="Search" onClick="javascript: 
                  switch(document.getElementById('search').value) {
                     case('Partitioning hard drives in Windows'):
                        window.open('blog.html#14','_self');
                        break;
                     case('Resume tips'):
                        window.open('blog.html#13','_self');
                        break;
                     case('2 Arduino projects'):
                        window.open('blog.html#12','_self');
                        break;
                     case('Including multiple Lua scripts'):
                        window.open('blog.html#11','_self');
                        break;
                     case('Introduction to Wireshark dissectors'):
                        window.open('blog.html#10','_self');
                        break;
                     case('Implementing DHCP on Junos'):
                        window.open('blog.html#9','_self');
                        break;
                     case('NVIDIA crashing on Linux'):
                        window.open('blog.html#8','_self');
                        break;
                     case('Dual booting a Windows machine'):
                        window.open('blog.html#7','_self');
                        break;
                     case('Juniper operating system'):
                        window.open('blog.html#6','_self');
                        break;
                     case('Five recruiters one question'):
                        window.open('blog.html#5','_self');
                        break;
                     case('SD Hacks experience'):
                        window.open('blog.html#4','_self');
                        break;
                     case('Resume growth and socio-economic entitlement'):
                        window.open('blog.html#3','_self');
                        break;
                     case('The study of Computer Science'):
                        window.open('blog.html#2','_self');
                        break;
                     case('University vs. industry'):
                        window.open('blog.html#1','_self');
                        break;
                     default:
                        window.open('blog404.html','_self');
                  }"/></center>
               <datalist id="posts">
               	  <option value="Partitioning hard drives in Windows">
                  <option value="Resume tips">
               	  <option value="2 Arduino projects">
               	  <option value="Including multiple Lua scripts">
                  <option value="Introduction to Wireshark dissectors">
                  <option value="Implementing DHCP on Junos">
                  <option value="NVIDIA crashing on Linux">
                  <option value="Dual booting a Windows machine">
                  <option value="Juniper operating system">
                  <option value="Five recruiters one question">
                  <option value="SD Hacks experience">
                  <option value="Resume growth and socio-economic entitlement">
                  <option value="The study of Computer Science">
                  <option value="University vs. industry">
               </datalist>

               <hr color="grey"/>

               <center>
                  <font size="5px" style="color:black"><b>Recent Posts</b></font> 
               </center>

               <font size="4px">

               <a href="blog.html#14">Partitioning hard drives in Windows</a><br/>
               <a href="blog.html#13">Resume tips</a><br/>
               <a href="blog.html#12">2 Arduino projects</a><br/>

               <hr color="grey"/>

               <center>
                  <font size="5px" style="color:black"><b>Categories</b></font> 
               </center>

               <font size="4px"><a href="blogengineering.html">Engineering</a><br/>
               <a href="blogtechnical.html">Technical</a><br/>
               <a href="blogexperience.html">Experience</a><br/>
               <a href="blogindustry.html">Industry</a></font><br/>

               <hr color="grey"/>

               <center>
                  <font size="5px" style="color:black"><b>Archives</b></font> 
               </center>


               <font size="4px">
               	  <a href="blogjuly2018.html">July 2018</a><br/>
               	  <a href="blogjune2018.html">June 2018</a><br/>
               	  <a href="blogmay2018.html">May 2018</a><br/>
               	  <a href="blogapr2018.html">April 2018</a><br/>
               	  <a href="blogmar2018.html">March 2018</a><br/>
               	  <a href="blogfeb2018.html">Februrary 2018</a><br/>
                  <a href="blogjan2018.html">January 2018</a><br/>
               </font>

               <hr color="grey"/>

               <center>
                  <font size="4px"><a href="blog.html">Blog home</a><br/></font>
               </center>
            </div>
            
         </div>
         <div class="col-lg-9">
	    <a name="10"></a>
            <br />

            <div class="box">
            <!-------------------------------------------------------------------------------------------------------------------------------------->
               <div class="title">
                  <center><font size="7px" style="color:grey;font-family:Georgia"><b>Introduction to Wireshark dissectors<br /></b></font>
                  <p>
                     <font size="4px" style="color:white"><b>15 May 2018 | Engineering</b></font><br/>
                  </p></center>
               </div>
               <div style="text-align:left">
                   <font size="4px" style="color:black">
					I've been given several tasks involving computer networks. A good tool I've been using is Wireshark, a
					packet sniffing software. This software detects a chosen interface to capture packets from and displays
					the capture information in columns, decoded packet information, and raw data. Columns can be added and
					customized. A user can decode packets as specific protocols. Raw data can be viewed as hex or binary. The GUI
					looks like the following:<br/><br/>
					<img src=wireshark.png height=100% width=100%/><br/><br/>
					What I will be talking about in this blog post is how to create a custom packet detail as seen from the image.
					The packet detail is created based on a dissector typically written in Lua which I will be using for this
					tutorial. The dissector is to conform with how the packet is decoded given the protocol and will decode the 
					payload of a packet to be decoded under that protocol. Dissected output will show in packet detail. Anything
					that is not dissected will be displayed as raw data.<br/><br/>
					<b>Writing the Lua script:</b><br/>
					For Wireshark to detect your Lua scripts, they will need to be stored in the "plugins" directory of Wireshark.
					In Linux, you can find ".wireshark" in the home directory and for Windows in "%appdata%". The first thing to do is
					to create a protocol using the Lua function <font style="font-family:'Courier New'">Proto</font>. This function
					takes a string of the protocol name and a string of its description. Call the <font style="font-family:'Courier New'">
					dissector</font> function on the protocol which takes in the packet buffer, information, and tree as parameters
					which I will explain soon. We then need to add the port using <font style="font-family:'Courier New'">Dissector.get</font>
					followed by mapping it with the protocol using <font style="font-family:'Courier New'">add</font>. See the
					more detailed example below:<br/><br/>
					<font style="font-family:'Courier New'">
					<div class="codebox">
					<font color="blue">-- create a protocol</font><br/>
					<font color="lime">trivial_proto = Proto(<font color="lightblue">"trivial"</font>, <font color="lightblue">"Trivial Protocol"</font>)<br/><br/>
					<font color="blue">-- create the dissector function</font><br/>
					<font color="blue">-- @param: buffer = space in packet to decode;<br/>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pinfo = packet info;<br/> 
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tree = container of buffer and info</font><br/>
					<font color="orange">function</font> trivial_proto.dissector(<font color="lightblue">buffer</font>, <font color="lightblue">pinfo</font>, <font color="lightblue">tree</font>)<br/>
					&nbsp;&nbsp;&nbsp;<font color="blue">-- print name of protocol in its column</font><br>
					&nbsp;&nbsp;&nbsp;pinfo.cols.protocol = <font color="lightblue">"TRIVIAL"</font><br/>
					&nbsp;&nbsp;&nbsp;<font color="blue">-- add sub payload into tree</font><br/>
					&nbsp;&nbsp;&nbsp;<font color="orange">local</font> subtree = tree:add(trivial_proto, buffer(), <font color="lightblue">"Trivial Protocol Data"</font>)<br/>
					<font color="blue">&nbsp;&nbsp;&nbsp;-- code for dissector goes here</font><br/>
					<font color="orange">end</font><br/><br/>
					<font color="blue">-- create table of ports to catch packets from</font><br/>
					udp_table = DissectorTable.get(<font color="lightblue">"udp.port"</font>)<br/>
					<font color="blue">-- register protocol to table</font><br/>
					udp_table:add(<font color="red">7777</font>, <font color="lightblue">trivial_proto</font>)</font>
					</div>
					</font>
					<br/><br/>
					The above code simply creates a protocol, assumes it comes from port 7777, and decodes accordingly. To understand how dissection
					works, we need to look at the parameters I mentioned earlier:<br/>
					<b>buffer</b> - space allocated specified by bytes where dissection will take place<br/>
					<b>pinfo</b> - fields displayed in the columns in Wireshark; above example uses the "protocol" field<br/>
					<b>tree</b> - protocol section in packet detail; "subtree" is a subsection within the trivial protocol area<br/><br/>
					The packet dissection process will be heavily reliant on the buffer and output the decoded packet in the tree to
					be displayed in the packet detail in Wireshark. "pinfo" is a field you can use to print specific information
					about the packet being dissected. To dissect the raw data, the typical functions to use are:<br/>
					<font style="font-family:'Courier New'">uint()</font> - converts buffer area to numerical output; <b>must be called when outputting bytes</b><br/>
					<font style="font-family:'Courier New'">bitfield(starting_bit, number_bits_to_dissect)</font> - dissects specific bits while converting to numerical output; <b>must not exceed buffer</b><br/><br/>
					These functions are called on the <font style="font-family:'Courier New'">buffer</font> object (parameters are starting byte and how many bytes to go through) that itself takes in numerical
					parameters to highlight which bytes are dissected in raw data. I personally haven't figured out how to highlight bits that are not byte
					aligned. If you figure this out, I would love to hear about it <a href="contact.html" target="_blank">here</a>. If you need to
					make use of information outside of the dissection buffer, you can retrieve that data with <font style="font-family:'Courier New'">Field.new("field.name")</font>.
					Below is an example protocol called "Trivial" and a code snippet for its dissection:<br/><br/>
					<center>
					<table style="width: 100%" border="1px solid black">
					   <tr>
					      <th colspan="3">
					         <center><b>Trivial</b></center>
					      </th>
					   </tr>
					   <tr>
					      <th>
					         <center><b>Starting bit</b></center>
					      </th>
					      <th>
					         <center><b>Bit size</b></center>
					      </th>
					      <th>
					         <center><b>Data</b></center>
					      </th>
					   </tr>
					   <tr>
					      <th>
					         <font style="font-weight: normal"><center>0</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>15</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>Trivial descriptor (Constant value)</center></font>
					      </th>
					   </tr>
					   <tr>
					      <th>
					         <font style="font-weight: normal"><center>15</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>1</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>Variable Data present flag</center></font>
					      </th>
					   </tr>
					   <tr>
					      <th>
					         <font style="font-weight: normal"><center>16 with Variable Data</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>8</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>Bit size of Variable Data</center></font>
					      </th>
					      <tr>
					      <th>
					         <font style="font-weight: normal"><center>16 without Variable Data<br/>
					         24 with Variable Data</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>8</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>Fixed Data</center></font>
					      </th>
					      <tr>
					      <th>
					         <font style="font-weight: normal"><center>32 with Variable Data</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>varying size</center></font>
					      </th>
					      <th>
					         <font style="font-weight: normal"><center>Variable Data</center></font>
					      </th>
					   </tr>
					</table><br/><br/>	
					</center>
					<div class="codebox">
						<font style="font-family:'Courier New'" color="lime">
					       <font color="blue">-- code for dissector goes here</font><br/>
					       <font color="orange">if</font> buffer(0, 2):bitfield(0, 15) == TRIVIAL_DESCRIPTOR <font color="orange">then</font><br/>
					       &nbsp;&nbsp;&nbsp;<font color="blue">-- routine with variable data</font><br/>
					       &nbsp;&nbsp;&nbsp;<font color="orange">if</font> buffer(0, 2):bitfield(15, 1) == 1 <font color="orange">then</font><br/>
					       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="orange">local</font> bit_size = buffer(<font color="red">2</font>,<font color="red">1</font>):uint()<br/>
					       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subtree:add(buffer(<font color="red">3</font>, <font color="red">1</font>), <font color="lightblue">"Fixed Data: "</font> .. buffer(<font color="red">3</font>, <font color="red">1</font>):uint())<br/>
					       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subtree:add(buffer(<font color="red">4</font>, (bit_size / <font color="red">8</font>) + <font color="red">1</font>), <font color="lightblue">"Variable Data: "</font> ..<br/>
					       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer(<font color="red">4</font>, (bit_size / <font color="red">8</font>) + <font color="red">1</font>):bitfield(<font color="red">32</font>, bit_size))<br/>
					       &nbsp;&nbsp;&nbsp;<font color="blue">-- routine without variable data</font><br/>
					       &nbsp;&nbsp;&nbsp;<font color="orange">else</font><br/>
					       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subtree:add(buffer(<font color="red">2</font>, <font color="red">1</font>), <font color="lightblue">"Fixed Data: "</font> .. buffer(<font color="red">2</font>, <font color="red">1</font>):uint())<br/>
					       &nbsp;&nbsp;&nbsp;<font color="orange">endif</font><br/>
					       <font color="orange">endif</font>
						</font>
					</div><br/><br/>
					<b>Adding core dump:</b><br/>
					If you are planning to record packets for several hours, a neat feature to add is core dump. This is simply giving your
					dissector the ability to spit the dissection in a .csv file to be opened in a spreadsheet. This is useful for looking at
					specific behaviors by values displayed in Excel format. The only concept I am adding here is implementing file I/O in
					Lua. You may find the following functions useful:<br/>
					<font style="font-family:'Courier New'">io.open(file_name,mode)</font> - open a file given by the string name<br/>
					<font style="font-family:'Courier New'">file_name:close()</font> - close the file; <b>end file I/O with this call</b><br/>
					<font style="font-family:'Courier New'">file_name:read()</font> - read file contents<br/>
					<font style="font-family:'Courier New'">file_name_write(content)</font> - write contents to file<br/><br/>
					<b>List of file opening modes:<br/></b>
					"r" - read-only; also default mode<br/>
					"w" - write to file by overriding existing content<br/>
					"a" - append to the file<br/>
					"r+" - read and write<br/>
					"w+" - read and write and overwrite existing file<br/>
					"a" - append and read<br/>
              </font>
		   </font>
               </div>
            </div>
                   </font>
                   </font>
                   </font>
                   </font>
                   </font>
                   </font>
                  </font>
               
         </div>
         </div>
         </div>
         </div>
         </div>

         <br/>
         <br/>
         <br/>

         <center>
            <p><font size="4px" style="color:white">© Copyright 2018 Jeremy Cruz</p>
         </center>
      
      </div>
   </body>
</html>
